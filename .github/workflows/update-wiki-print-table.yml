name: üõ†Ô∏è Auto-refresh 3D-Print Checklist (Wiki)

on:
  # Run when any STL / 3MF in 3D_Printing/ changes‚Ä¶
  push:
    paths:
      - "3D_Printing/**"
  # ‚Ä¶and once nightly as a safety-net
  schedule:
    - cron: "0 3 * * *"    # 03:00 UTC

permissions:
  contents: read            # checkout needs this
  # we‚Äôll push to the wiki with a PAT, not this token

jobs:
  refresh:
    runs-on: ubuntu-latest

    steps:
    # 1Ô∏è‚É£ pull your repo so the script can see the files
    - name: Check out code
      uses: actions/checkout@v4   # official action :contentReference[oaicite:0]{index=0}

    # 2Ô∏è‚É£ provision Python
    - name: Set up Python 3.11
      uses: actions/setup-python@v5
      with:
        python-version: "3.11"

    # 3Ô∏è‚É£ install the tiny deps
    - name: Install Python deps
      run: |
        python -m pip install --upgrade pip
        pip install PyGithub tabulate

    # 4Ô∏è‚É£ run the generator ‚Äì it writes the markdown file
    - name: Generate checklist markdown
      run: |
        python scripts/make_print_table.py > "Build-Instruction:-3D-Printed-Parts.md"

    # 5Ô∏è‚É£ clone the wiki repo with the PAT
    - name: Clone wiki repo
      env:
        GH_PAT: ${{ secrets.GH_PAT }}
      run: |
        git clone "https://x-access-token:${GH_PAT}@github.com/${{ github.repository }}.wiki.git" wiki

    # 6Ô∏è‚É£ copy new file into wiki, commit & push
    - name: Update wiki page
      env:
        GH_PAT: ${{ secrets.GH_PAT }}
      run: |
        cp "Build-Instruction:-3D-Printed-Parts.md" wiki/
        cd wiki
        git config user.name  "Mimic-CI Bot"
        git config user.email "actions@github.com"
        git add "Build-Instruction:-3D-Printed-Parts.md"
        git commit -m "docs: auto-refresh 3D-print checklist [skip ci]" || echo "No changes"
        git push origin HEAD
