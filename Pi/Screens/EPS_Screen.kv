#:import dp kivy.metrics.dp

<EPS_Screen>:
    name: 'eps'
    FloatLayout:
        Image:
            id: eps_sun
            source: f'{root.mimic_directory}/Mimic/Pi/imgs/eps/sun.png'
            fit_mode: "scale-down"
            pos_hint: {"center_x": 0.5, "center_y": 0.9}
            size_hint_y: 0.2
            color: 1,1,1,0.1
        Label:
            id: solarbeta
            pos_hint: {"center_x": 0.5, "center_y": 0.9}
            text: 'n/a'
            markup: True
            color: root.signalcolor
            size_hint_y: 0.4
            font_size: min(self.height * 0.10, dp(28))
        Label:
            id: ssarj_label
            pos_hint: {"center_x": 0.40, "center_y": 0.58}
            text: 'SSARJ:'
            markup: True
            color: 1,1,1
            size_hint_y: 0.4
            font_size: min(self.height * 0.08, dp(24))
        Label:
            id: ssarj_mode
            pos_hint: {"center_x": 0.40, "center_y": 0.53}
            text: '-'
            markup: True
            color: 1,1,1
            size_hint_y: 0.4
            font_size: min(self.height * 0.08, dp(24))
        Label:
            id: ssarj_value
            pos_hint: {"center_x": 0.40, "center_y": 0.48}
            text: '0.003'
            markup: True
            color: root.signalcolor
            size_hint_y: 0.4
            font_size: min(self.height * 0.08, dp(24))
        Label:
            id: psarj_label
            pos_hint: {"center_x": 0.60, "center_y": 0.58}
            text: 'PSARJ:'
            markup: True
            color: 1,1,1
            size_hint_y: 0.4
            font_size: min(self.height * 0.08, dp(24))
        Label:
            id: psarj_mode
            pos_hint: {"center_x": 0.60, "center_y": 0.53}
            text: '-'
            markup: True
            color: 1,1,1
            size_hint_y: 0.4
            font_size: min(self.height * 0.08, dp(24))
        Label:
            id: psarj_value
            pos_hint: {"center_x": 0.60, "center_y": 0.48}
            text: '0.003'
            markup: True
            color: root.signalcolor
            size_hint_y: 0.4
            font_size: min(self.height * 0.08, dp(24))
##----------------------------------------------------------------------        
        Label:
            pos_hint: {"center_x": 0.57, "center_y": 0.85}
            text: '2A'
            markup: True
            color: 1,0,1
            size_hint_y: 0.4
            font_size: self.height * 0.10
        Image:
            id: array_2a
            source: f"{root.mimic_directory}/Mimic/Pi/imgs/eps/array-charging.zip"
            anim_delay: 0.12
            color: 1,1,1,1
            size_hint_y: 0.5
            fit_mode: "contain"
            anim_loop: 0
            pos_hint: {"center_x": 0.68, "center_y": 0.75}
        Label:
            id: beta2a_value
            pos_hint: {"center_x": 0.57, "center_y": 0.78}
            text: '0.003'
            markup: True
            color: root.signalcolor
            size_hint_y: 0.4
            font_size: min(self.height * 0.10, dp(28))
        Label:
            id: v2a_value
            pos_hint: {"center_x": 0.57, "center_y": 0.68}
            text: '0.003'
            markup: True
            color: root.signalcolor
            size_hint_y: 0.4
            font_size: min(self.height * 0.10, dp(28))
        Label:
            id: c2a_value
            pos_hint: {"center_x": 0.57, "center_y": 0.73}
            text: '0.003'
            markup: True
            color: root.signalcolor
            size_hint_y: 0.4
            font_size: min(self.height * 0.10, dp(28))

##----------------------------------------------------------------------        
        Label:
            pos_hint: {"center_x": 0.93, "center_y": 0.42}
            text: '2B'
            markup: True
            color: 1,0,1
            size_hint_y: 0.4
            font_size: self.height * 0.10
        Image:
            id: array_2b
            source: f"{root.mimic_directory}/Mimic/Pi/imgs/eps/array-charging.zip"
            anim_delay: 0.12
            anim_loop: 0
            color: 1,1,1,1
            size_hint_y: 0.5
            fit_mode: "contain"
            pos_hint: {"center_x": 0.83, "center_y": 0.25}
            angle: 0
            canvas.before:
                PushMatrix
                Scale:
                    x: 1
                    y: -1
                    z: 1
                    origin: self.center
            canvas.after:
                PopMatrix
        Label:
            id: beta2b_value
            pos_hint: {"center_x": 0.94, "center_y": 0.35}
            text: '0.003'
            markup: True
            color: root.signalcolor
            size_hint_y: 0.4
            font_size: min(self.height * 0.10, dp(28))
        Label:
            id: v2b_value
            pos_hint: {"center_x": 0.94, "center_y": 0.25}
            text: '0.003'
            markup: True
            color: root.signalcolor
            size_hint_y: 0.4
            font_size: min(self.height * 0.10, dp(28))
        Label:
            id: c2b_value
            pos_hint: {"center_x": 0.94, "center_y": 0.30}
            text: '0.003'
            markup: True
            color: root.signalcolor
            size_hint_y: 0.4
            font_size: min(self.height * 0.10, dp(28))

##----------------------------------------------------------------------        
        Label:
            pos_hint: {"center_x": 0.43, "center_y": 0.42}
            text: '1A'
            markup: True
            color: 1,0,1
            size_hint_y: 0.4
            font_size: self.height * 0.10
        Image:
            id: array_1a
            source: f"{root.mimic_directory}/Mimic/Pi/imgs/eps/array-charging.zip"
            anim_delay: 0.12
            anim_loop: 0
            color: 1,1,1,1
            size_hint_y: 0.5
            fit_mode: "contain"
            pos_hint: {"center_x": 0.32, "center_y": 0.25}
            angle: 0
            canvas.before:
                PushMatrix
                Scale:
                    x: 1
                    y: -1
                    z: 1
                    origin: self.center
            canvas.after:
                PopMatrix
        Label:
            id: beta1a_value
            pos_hint: {"center_x": 0.43, "center_y": 0.35}
            text: '0.003'
            markup: True
            color: root.signalcolor
            size_hint_y: 0.4
            font_size: min(self.height * 0.10, dp(28))
        Label:
            id: v1a_value
            pos_hint: {"center_x": 0.43, "center_y": 0.25}
            text: '0.003'
            markup: True
            color: root.signalcolor
            size_hint_y: 0.4
            font_size: min(self.height * 0.10, dp(28))
        Label:
            id: c1a_value
            pos_hint: {"center_x": 0.43, "center_y": 0.30}
            text: '0.003'
            markup: True
            color: root.signalcolor
            size_hint_y: 0.4
            font_size: min(self.height * 0.10, dp(28))

##----------------------------------------------------------------------        
        Label:
            pos_hint: {"center_x": 0.07, "center_y": 0.85}
            text: '1B'
            markup: True
            color: 1,0,1
            size_hint_y: 0.4
            font_size: self.height * 0.10
        Image:
            id: array_1b
            source: f"{root.mimic_directory}/Mimic/Pi/imgs/eps/array-charging.zip"
            anim_delay: 0.12
            color: 1,1,1,1
            size_hint_y: 0.5
            fit_mode: "contain"
            anim_loop: 0
            pos_hint: {"center_x": 0.17, "center_y": 0.75}
        Label:
            id: beta1b_value
            pos_hint: {"center_x": 0.06, "center_y": 0.78}
            text: '0.003'
            markup: True
            color: root.signalcolor
            size_hint_y: 0.4
            font_size: min(self.height * 0.10, dp(28))
        Label:
            id: v1b_value
            pos_hint: {"center_x": 0.06, "center_y": 0.68}
            text: '0.003'
            markup: True
            color: root.signalcolor
            size_hint_y: 0.4
            font_size: min(self.height * 0.10, dp(28))
        Label:
            id: c1b_value
            pos_hint: {"center_x": 0.06, "center_y": 0.73}
            text: '0.003'
            markup: True
            color: root.signalcolor
            size_hint_y: 0.4
            font_size: min(self.height * 0.10, dp(28))

##----------------------------------------------------------------------        
        Label:
            pos_hint: {"center_x": 0.57, "center_y": 0.42}
            text: '4A'
            markup: True
            color: 1,0,1
            size_hint_y: 0.4
            font_size: self.height * 0.10
        Image:
            id: array_4a
            source: f"{root.mimic_directory}/Mimic/Pi/imgs/eps/array-charging.zip"
            anim_delay: 0.12
            anim_loop: 0
            color: 1,1,1,1
            size_hint_y: 0.5
            fit_mode: "contain"
            pos_hint: {"center_x": 0.68, "center_y": 0.25}
            angle: 0
            canvas.before:
                PushMatrix
                Scale:
                    x: 1
                    y: -1
                    z: 1
                    origin: self.center
            canvas.after:
                PopMatrix
        Label:
            id: beta4a_value
            pos_hint: {"center_x": 0.57, "center_y": 0.35}
            text: '0.003'
            markup: True
            color: root.signalcolor
            size_hint_y: 0.4
            font_size: min(self.height * 0.10, dp(28))
        Label:
            id: v4a_value
            pos_hint: {"center_x": 0.57, "center_y": 0.25}
            text: '0.003'
            markup: True
            color: root.signalcolor
            size_hint_y: 0.4
            font_size: min(self.height * 0.10, dp(28))
        Label:
            id: c4a_value
            pos_hint: {"center_x": 0.57, "center_y": 0.30}
            text: '0.003'
            markup: True
            color: root.signalcolor
            size_hint_y: 0.4
            font_size: min(self.height * 0.10, dp(28))

##----------------------------------------------------------------------        
        Label:
            pos_hint: {"center_x": 0.93, "center_y": 0.85}
            text: '4B'
            markup: True
            color: 1,0,1
            size_hint_y: 0.4
            font_size: self.height * 0.10
        Image:
            id: array_4b
            source: f"{root.mimic_directory}/Mimic/Pi/imgs/eps/array-offline.png"
            anim_delay: 0.12
            color: 1,1,1,1
            size_hint_y: 0.5
            anim_loop: 0
            fit_mode: "contain"
            pos_hint: {"center_x": 0.83, "center_y": 0.75}
        Label:
            id: beta4b_value
            pos_hint: {"center_x": 0.94, "center_y": 0.78}
            text: '0.003'
            markup: True
            color: 1,1,1
            color: root.signalcolor
            size_hint_y: 0.4
            font_size: min(self.height * 0.10, dp(28))
        Label:
            id: v4b_value
            pos_hint: {"center_x": 0.94, "center_y": 0.68}
            text: '0.003'
            markup: True
            color: root.signalcolor
            size_hint_y: 0.4
            font_size: min(self.height * 0.10, dp(28))
        Label:
            id: c4b_value
            pos_hint: {"center_x": 0.94, "center_y": 0.73}
            text: '0.003'
            markup: True
            color: root.signalcolor
            size_hint_y: 0.4
            font_size: min(self.height * 0.10, dp(28))

##----------------------------------------------------------------------        
        Label:
            pos_hint: {"center_x": 0.43, "center_y": 0.85}
            text: '3A'
            markup: True
            color: 1,0,1
            size_hint_y: 0.4
            font_size: self.height * 0.10
        Image:
            id: array_3a
            source: f"{root.mimic_directory}/Mimic/Pi/imgs/eps/array-discharging.zip"
            anim_delay: 0.12
            anim_loop: 0
            color: 1,1,1,1
            size_hint_y: 0.5
            fit_mode: "contain"
            pos_hint: {"center_x": 0.32, "center_y": 0.75}
        Label:
            id: beta3a_value
            pos_hint: {"center_x": 0.43, "center_y": 0.78}
            text: '0.003'
            markup: True
            color: root.signalcolor
            size_hint_y: 0.4
            font_size: min(self.height * 0.10, dp(28))
        Label:
            id: v3a_value
            pos_hint: {"center_x": 0.43, "center_y": 0.68}
            text: '0.003'
            markup: True
            color: root.signalcolor
            size_hint_y: 0.4
            font_size: min(self.height * 0.10, dp(28))
        Label:
            id: c3a_value
            pos_hint: {"center_x": 0.43, "center_y": 0.73}
            text: '0.003'
            markup: True
            color: root.signalcolor
            size_hint_y: 0.4
            font_size: min(self.height * 0.10, dp(28))

##----------------------------------------------------------------------        
        Label:
            pos_hint: {"center_x": 0.07, "center_y": 0.42}
            text: '3B'
            markup: True
            color: 1,0,1
            size_hint_y: 0.4
            font_size: self.height * 0.10
        Image:
            id: array_3b
            source: f"{root.mimic_directory}/Mimic/Pi/imgs/eps/array-charged.zip"
            anim_delay: 0.12
            anim_loop: 0
            size_hint_y: 0.5
            color: 1,1,1,1
            fit_mode: "contain"
            pos_hint: {"center_x": 0.17, "center_y": 0.25}
            angle: 0
            canvas.before:
                PushMatrix
                Scale:
                    x: 1
                    y: -1
                    z: 1
                    origin: self.center
            canvas.after:
                PopMatrix
        Label:
            id: beta3b_value
            pos_hint: {"center_x": 0.06, "center_y": 0.35}
            text: '0.003'
            markup: True
            color: root.signalcolor
            size_hint_y: 0.4
            font_size: min(self.height * 0.10, dp(28))
        Label:
            id: v3b_value
            pos_hint: {"center_x": 0.06, "center_y": 0.25}
            text: '0.003'
            markup: True
            color: root.signalcolor
            size_hint_y: 0.4
            font_size: min(self.height * 0.10, dp(28))
        Label:
            id: c3b_value
            pos_hint: {"center_x": 0.06, "center_y": 0.30}
            text: '0.003'
            markup: True
            color: root.signalcolor
            size_hint_y: 0.4
            font_size: min(self.height * 0.10, dp(28))


##----------------------------------------------------------------------        
        Label:
            id: usos_power
            pos_hint: {"center_x": 0.5, "center_y": 0.55}
            text: ''
            markup: True
            color: root.signalcolor
            size_hint_y: 0.4
            font_size: min(self.height * 0.10, dp(30))
            
        # ---------- STATUS DISPLAY (Bottom Rectangle) ----------
        Label:
            id: status_label
            text: ''
            size_hint: 1, 0.07
            background_color: 0, 0, 0, 0.8  # Semi-transparent black
            color: 0, 1, 0, 1  # Green text
            font_size: self.height * 0.6  # Scale font to label height
            text_size: self.size
            halign: 'center'
            valign: 'middle'
            pos_hint: {"center_x": 0.57, "center_y": 0.07}
        
        # ---------- BOTTOM TOOLBAR ----------
        Image:
            id: signal
            source: f"{root.mimic_directory}/Mimic/Pi/imgs/signal/signalred.zip"
            size_hint_y: 0.112
            anim_delay: 0.05
            anim_loop: 0
            fit_mode: "scale-down"
            pos_hint: {"center_x": 0.05, "center_y": 0.07}
        
        Image:
            id: arduino
            source: f"{root.mimic_directory}/Mimic/Pi/imgs/signal/arduino_offline.png"
            size_hint_y: 0.15
            anim_delay: 0.2
            anim_loop: -1
            fit_mode: "scale-down"
            pos_hint: {"center_x": 0.14, "center_y": 0.08}
        
        Label:
            id: arduino_count
            pos_hint: {"center_x": 0.14, "center_y": 0.08}
            text: ''
            markup: True
            color: 1, 1, 1, 1
            font_size: self.height * 1
            size_hint: 0.06, 0.08
        
        # ─────────────────────── Navigation ────────────────────────────────

        Button:
            size_hint: 0.1, 0.11
            pos_hint: {"center_x": 0.9375, "center_y": 0.07}
            background_normal: f'{root.mimic_directory}/Mimic/Pi/imgs/eva/BackButton.png'
            background_down: f'{root.mimic_directory}/Mimic/Pi/imgs/eva/BackButton.png'
            border: 0,0,0,0    # avoid 9-slice margins
            on_release: app.root.current = 'mimic'