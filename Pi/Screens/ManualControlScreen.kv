#:import dp kivy.metrics.dp

<ManualControlScreen>:
    name: "manualcontrol"
    on_pre_enter: root.refresh_buttons()

    FloatLayout:
        Image:
            source: f"{root.mimic_directory}/Mimic/Pi/imgs/control/ControlBackground.png"
            fit_mode: "fill"

        # ---- LEFT TRUSS -----------------------------------------------------
        Button:
            id: Beta1B_Button
            size_hint: 0.08, 0.30
            pos_hint: {"center_x": 0.10, "center_y": 0.70}
            text: "1B"
            font_size: dp(30)
            on_press: root.set_active("beta1b")
        Button:
            id: Beta3B_Button
            size_hint: 0.08, 0.30
            pos_hint: {"center_x": 0.10, "center_y": 0.30}
            text: "3B"
            font_size: dp(30)
            on_press: root.set_active("beta3b")

        Button:
            id: SSARJ_Button
            size_hint: 0.20, 0.10
            pos_hint: {"center_x": 0.15, "center_y": 0.50}
            text: "Stbd Truss"
            font_size: dp(30)
            on_press: root.set_active("ssarj")

        Button:
            id: Beta3A_Button
            size_hint: 0.08, 0.30
            pos_hint: {"center_x": 0.20, "center_y": 0.70}
            text: "3A"
            font_size: dp(30)
            on_press: root.set_active("beta3a")
        Button:
            id: Beta1A_Button
            size_hint: 0.08, 0.30
            pos_hint: {"center_x": 0.20, "center_y": 0.30}
            text: "1A"
            font_size: dp(30)
            on_press: root.set_active("beta1a")

        # ---- HRS / TRRJ -----------------------------------------------------
        Button:
            id: STRRJ_Button
            size_hint: 0.10, 0.30
            pos_hint: {"center_x": 0.30, "center_y": 0.50}
            text: "Stbd\nHRS"
            font_size: dp(25)
            on_press: root.set_active("strrj")

        Button:
            id: PTRRJ_Button
            size_hint: 0.10, 0.30
            pos_hint: {"center_x": 0.40, "center_y": 0.50}
            text: "Port\nHRS"
            font_size: dp(25)
            on_press: root.set_active("ptrrj")

        # ---- CENTER / PSARJ -------------------------------------------------
        Button:
            id: PSARJ_Button
            size_hint: 0.20, 0.10
            pos_hint: {"center_x": 0.55, "center_y": 0.50}
            text: "Port Truss"
            font_size: dp(30)
            on_press: root.set_active("psarj")

        # ---- RIGHT TRUSS ----------------------------------------------------
        Button:
            id: Beta2A_Button
            size_hint: 0.08, 0.30
            pos_hint: {"center_x": 0.50, "center_y": 0.70}
            text: "2A"
            font_size: dp(30)
            on_press: root.set_active("beta2a")
        Button:
            id: Beta4A_Button
            size_hint: 0.08, 0.30
            pos_hint: {"center_x": 0.50, "center_y": 0.30}
            text: "4A"
            font_size: dp(30)
            on_press: root.set_active("beta4a")

        Button:
            id: Beta2B_Button
            size_hint: 0.08, 0.30
            pos_hint: {"center_x": 0.60, "center_y": 0.30}
            text: "2B"
            font_size: dp(30)
            on_press: root.set_active("beta2b")
        Button:
            id: Beta4B_Button
            size_hint: 0.08, 0.30
            pos_hint: {"center_x": 0.60, "center_y": 0.70}
            text: "4B"
            font_size: dp(30)
            on_press: root.set_active("beta4b")

        # ---- CONTROL BUTTON STACK ------------------------------------------
        # Set 0 / Set 90
        Button:
            id: set0
            size_hint: 0.10, 0.07
            pos_hint: {"center_x": 0.80, "center_y": 0.75}
            text: "Set 0"
            font_size: dp(20)
            on_release: root.set_zero()
        Button:
            id: set90
            size_hint: 0.10, 0.07
            pos_hint: {"center_x": 0.90, "center_y": 0.75}
            text: "Set 90"
            font_size: dp(20)
            on_release: root.set_ninety()

        # Calibrate zero (zero all joints)
        Button:
            size_hint: 0.20, 0.07
            pos_hint: {"center_x": 0.85, "center_y": 0.62}
            text: "Calibrate Zero"
            font_size: dp(20)
            on_press: root.zero_joints()

        # Increment buttons
        Button:
            size_hint: 0.10, 0.07
            pos_hint: {"center_x": 0.80, "center_y": 0.49}
            text: "-5"
            font_size: dp(20)
            on_press: root.increment_active(-5)
        Button:
            size_hint: 0.10, 0.07
            pos_hint: {"center_x": 0.90, "center_y": 0.49}
            text: "+5"
            font_size: dp(20)
            on_press: root.increment_active(5)

        Button:
            size_hint: 0.10, 0.07
            pos_hint: {"center_x": 0.80, "center_y": 0.40}
            text: "-20"
            font_size: dp(20)
            on_press: root.increment_active(-20)
        Button:
            size_hint: 0.10, 0.07
            pos_hint: {"center_x": 0.90, "center_y": 0.40}
            text: "+20"
            font_size: dp(20)
            on_press: root.increment_active(20)

        Button:
            size_hint: 0.10, 0.07
            pos_hint: {"center_x": 0.80, "center_y": 0.31}
            text: "-90"
            font_size: dp(20)
            on_press: root.increment_active(-90)
        Button:
            size_hint: 0.10, 0.07
            pos_hint: {"center_x": 0.90, "center_y": 0.31}
            text: "+90"
            font_size: dp(20)
            on_press: root.increment_active(90)

        # ---- SIGNAL + ARDUINO ICONS ----------------------------------------
        Image:
            id: signal
            source: f"{root.mimic_directory}/Mimic/Pi/imgs/signal/pulse-transparent.zip"
            size_hint_y: 0.15
            anim_delay: 0.12
            anim_loop: 0
            pos_hint: {"center_x": 0.05, "center_y": 0.07}
            fit_mode: "scale-down"

        Image:
            id: arduino
            source: f"{root.mimic_directory}/Mimic/Pi/imgs/signal/arduino_offline.png"
            size_hint_y: 0.15
            anim_delay: 0.2
            anim_loop: 0
            pos_hint: {"center_x": 0.14, "center_y": 0.08}
            fit_mode: "scale-down"
        Label:
            id: arduino_count
            pos_hint: {"center_x": 0.14, "center_y": 0.08}
            text: ""
            color: 1,1,1
            font_size: self.height * 0.3
            size_hint_y: 0.5

        # ---- BACK BUTTON ----------------------------------------------------
        Button:
            size_hint: 0.10, 0.11
            pos_hint: {"center_x": 0.9375, "center_y": 0.082}
            background_normal: f"{root.mimic_directory}/Mimic/Pi/imgs/eva/BackButton.png"
            on_release:
                root.manager.current = "main"
