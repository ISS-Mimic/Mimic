#:import Factory kivy.factory.Factory
#:import dp kivy.metrics.dp

<DescriptionPopup@Popup>:
    title: 'Recorded ISS Data Descriptions'
    size_hint: 0.6, 0.4
    auto_dismiss: True

    BoxLayout:
        orientation: 'vertical'
        padding: dp(12)
        spacing: dp(8)

        ScrollView:
            do_scroll_x: False
            do_scroll_y: True

            GridLayout:
                cols: 1
                size_hint_y: None
                height: self.minimum_height
                padding: dp(8), dp(8)
                spacing: dp(8)

                Label:
                    text: 'This will playback recorded data from when the Japanese HTV spacecraft berthed to the ISS. During berthing, the SARJs and nadir BGAs lock but the zenith BGAs autotrack'
                    size_hint_y: None
                    height: self.texture_size[1] + dp(12)
                    text_size: self.width, None
                    halign: 'left'
                    valign: 'middle'

                Label:
                    text: 'ISS Info 2: [More ISS info here]'
                    size_hint_y: None
                    height: self.texture_size[1] + dp(12)
                    text_size: self.width, None
                    halign: 'left'
                    valign: 'middle'

                Label:
                    text: 'ISS Info 3: [More ISS info here]'
                    size_hint_y: None
                    height: self.texture_size[1] + dp(12)
                    text_size: self.width, None
                    halign: 'left'
                    valign: 'middle'

                Label:
                    text: 'ISS Info 4: [More ISS info here]'
                    size_hint_y: None
                    height: self.texture_size[1] + dp(12)
                    text_size: self.width, None
                    halign: 'left'
                    valign: 'middle'

                Label:
                    text: 'ISS Info 5: [More ISS info here]'
                    size_hint_y: None
                    height: self.texture_size[1] + dp(12)
                    text_size: self.width, None
                    halign: 'left'
                    valign: 'middle'

                Label:
                    text: 'Demo orbit 2'
                    size_hint_y: None
                    height: self.texture_size[1] + dp(12)
                    text_size: self.width, None
                    halign: 'center'
                    valign: 'middle'


# If you need an image button later, define it like this and set source per instance:
# <ImageButton@ButtonBehavior+Image>:
#     allow_stretch: True
#     keep_ratio: True

<Playback_Screen>:
    name: 'playback'

    FloatLayout:

        # Title
        Label:
            text: 'Playback Control'
            size_hint: None, None
            font_size: dp(24)
            color: 1, 1, 1, 1
            text_size: self.width, None
            halign: 'center'
            valign: 'middle'
            width: dp(300)
            height: dp(40)
            pos_hint: {"center_x": 0.5, "top": 0.98}

        # ---------- Data Source ----------
        Label:
            text: 'Data Source:'
            size_hint: None, None
            font_size: dp(16)
            color: 1, 1, 1, 1
            width: dp(120)
            height: dp(36)
            pos_hint: {"x": 0.05, "top": 0.88}

        Spinner:
            id: file_dropdown
            text: 'Select Data File'
            size_hint: None, None
            width: dp(260)
            height: dp(36)
            values: ['HTV Demo', 'OFT2 Demo', 'Demo Demo']
            on_text: root.on_file_selected(args[1])
            pos_hint: {"x": 0.05, "top": 0.82}

        # ---------- Playback Speed ----------
        Label:
            text: 'Playback Speed:'
            size_hint: None, None
            font_size: dp(16)
            color: 1, 1, 1, 1
            width: dp(140)
            height: dp(36)
            pos_hint: {"x": 0.55, "top": 0.88}

        Spinner:
            id: speed_dropdown
            text: '10x'
            size_hint: None, None
            width: dp(160)
            height: dp(36)
            values: ['10x', '20x', '60x', '90x']
            on_text: root.set_playback_speed(args[1])
            pos_hint: {"x": 0.55, "top": 0.82}

        # ---------- Current File ----------
        Label:
            text: root.current_file if root.current_file else 'No file selected'
            size_hint: None, None
            font_size: dp(14)
            color: 0.8, 0.8, 0.8, 1
            text_size: self.width, None
            halign: 'center'
            valign: 'middle'
            width: dp(400)
            height: dp(24)
            pos_hint: {"center_x": 0.5, "top": 0.72}

        # ---------- Playback Controls ----------
        Button:
            text: 'Start'
            size_hint: None, None
            width: dp(140)
            height: dp(48)
            disabled: (not root.current_file) or (root.arduino_connected == False)
            on_press: root.start_playback()
            pos_hint: {"center_x": 0.25, "center_y": 0.56}

        Button:
            text: 'Stop'
            size_hint: None, None
            width: dp(140)
            height: dp(48)
            disabled: not root.is_playing
            on_press: root.stop_playback()
            pos_hint: {"center_x": 0.50, "center_y": 0.56}

        Button:
            text: 'Loop'
            size_hint: None, None
            width: dp(140)
            height: dp(48)
            background_color: (0.2, 0.8, 0.2, 1) if root.loop_enabled else (0.6, 0.6, 0.6, 1)
            on_press: root.toggle_loop()
            pos_hint: {"center_x": 0.75, "center_y": 0.56}

        # ---------- Status ----------
        Label:
            text: 'Playback Status:'
            size_hint: None, None
            font_size: dp(16)
            color: 1, 1, 1, 1
            text_size: self.size
            halign: 'right'
            valign: 'middle'
            width: dp(160)
            height: dp(28)
            pos_hint: {"x": 0.05, "center_y": 0.45}

        Label:
            id: status_label
            text: 'Stopped'  # bind this from Python as state changes
            size_hint: None, None
            font_size: dp(14)
            color: 0.8, 0.8, 0.8, 1
            text_size: self.size
            halign: 'left'
            valign: 'middle'
            width: dp(220)
            height: dp(28)
            pos_hint: {"x": 0.22, "center_y": 0.45}

        # ---------- Arduino Status ----------
        Label:
            id: arduino_status
            text: 'Arduino: Disconnected'
            size_hint: None, None
            font_size: dp(16)
            color: 1, 0, 0, 1
            text_size: self.size
            halign: 'left'
            valign: 'middle'
            width: dp(300)
            height: dp(32)
            pos_hint: {"x": 0.05, "center_y": 0.32}

        # ---------- Bottom Left Icons ----------
        Image:
            id: signal
            source: f"{root.mimic_directory}/Mimic/Pi/imgs/signal/signalred.zip"
            size_hint: None, None
            width: dp(48)
            height: dp(48)
            anim_delay: 0.05
            anim_loop: 0
            allow_stretch: True
            keep_ratio: True
            pos_hint: {"center_x": 0.06, "center_y": 0.10}

        Image:
            id: arduino
            source: f"{root.mimic_directory}/Mimic/Pi/imgs/signal/arduino_offline.png"
            size_hint: None, None
            width: dp(54)
            height: dp(54)
            anim_delay: 0.2
            anim_loop: 0
            allow_stretch: True
            keep_ratio: True
            pos_hint: {"center_x": 0.14, "center_y": 0.10}

        Label:
            id: arduino_count
            text: ''
            markup: True
            color: 1, 1, 1, 1
            size_hint: None, None
            font_size: dp(18)
            width: dp(80)
            height: dp(28)
            text_size: self.size
            halign: 'left'
            valign: 'middle'
            pos_hint: {"center_x": 0.20, "center_y": 0.10}

        # ---------- Back Button (Bottom Right) ----------
        Button:
            size_hint: None, None
            width: dp(80)
            height: dp(56)
            background_normal: f'{root.mimic_directory}/Mimic/Pi/imgs/eva/BackButton.png'
            background_down: f'{root.mimic_directory}/Mimic/Pi/imgs/eva/BackButton.png'
            on_release: app.root.current = 'main'
            pos_hint: {"right": 0.98, "center_y": 0.10}
