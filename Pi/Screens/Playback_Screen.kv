#:kivy 2.0.0
#:import Factory kivy.factory.Factory
#:import dp kivy.metrics.dp

<DescriptionPopup@Popup>:
    title: 'Recorded ISS Data Descriptions'
    size_hint: 0.8, 0.8
    auto_dismiss: True
    
    BoxLayout:
        orientation: 'vertical'
        padding: dp(12)
        spacing: dp(8)
        
        ScrollView:
            do_scroll_x: False
            do_scroll_y: True
            
            GridLayout:
                cols: 1
                size_hint_y: None
                height: self.minimum_height
                padding: dp(8), dp(8)
                spacing: dp(8)
                
                Label:
                    text: 'This will playback recorded data from when the Japanese HTV spacecraft berthed to the ISS. During berthing, the SARJs and nadir BGAs lock but the zenith BGAs autotrack'
                    size_hint_y: None
                    height: self.texture_size[1] + dp(12)
                    text_size: self.width, None
                    halign: 'left'
                    valign: 'middle'
                    color: 1, 1, 1, 1
                
                Label:
                    text: 'ISS Info 2: [More ISS info here]'
                    size_hint_y: None
                    height: self.texture_size[1] + dp(12)
                    text_size: self.width, None
                    halign: 'left'
                    valign: 'middle'
                    color: 1, 1, 1, 1
                
                Label:
                    text: 'ISS Info 3: [More ISS info here]'
                    size_hint_y: None
                    height: self.texture_size[1] + dp(12)
                    text_size: self.width, None
                    halign: 'left'
                    valign: 'middle'
                    color: 1, 1, 1, 1
                
                Label:
                    text: 'ISS Info 4: [More ISS info here]'
                    size_hint_y: None
                    height: self.texture_size[1] + dp(12)
                    text_size: self.width, None
                    halign: 'left'
                    valign: 'middle'
                    color: 1, 1, 1, 1
                
                Label:
                    text: 'ISS Info 5: [More ISS info here]'
                    size_hint_y: None
                    height: self.texture_size[1] + dp(12)
                    text_size: self.width, None
                    halign: 'left'
                    valign: 'middle'
                    color: 1, 1, 1, 1
                
                Label:
                    text: 'Demo orbit 2'
                    size_hint_y: None
                    height: self.texture_size[1] + dp(12)
                    text_size: self.width, None
                    halign: 'center'
                    valign: 'middle'
                    color: 1, 1, 1, 1

# If you need an image button later, define it like this and set source per instance:
# <ImageButton@ButtonBehavior+Image>:
#     allow_stretch: True
#     keep_ratio: True

<Playback_Screen>:
    name: 'playback'
    
    FloatLayout:
        Image:
            id: Playback_Background
            source: f'{root.mimic_directory}/Mimic/Pi/imgs/playback/SimulatedOrbitBackground.png'
            fit_mode: "fill"

        # Title
        Label:
            text: 'Orbit Data Playback'
            size_hint: None, None
            font_size: dp(28)
            color: 0, 1, 0, 1  # Bright green like the background
            text_size: self.width, None
            halign: 'center'
            valign: 'middle'
            width: dp(400)
            height: dp(50)
            pos_hint: {"center_x": 0.5, "top": 0.98}
        
        # ---------- LEFT PANEL: LOAD DATA ----------
        Label:
            text: 'LOAD DATA'
            size_hint: None, None
            font_size: dp(18)
            color: 0, 1, 0, 1  # Green text
            width: dp(150)
            height: dp(30)
            pos_hint: {"center_x": 0.17, "top": 0.88}
        
        Spinner:
            id: file_dropdown
            text: 'Select DATA'
            size_hint: None, None
            width: dp(200)
            height: dp(40)
            values: ['HTV Demo', 'OFT2 Demo', 'Demo Demo']
            on_text: root.on_file_selected(args[1])
            pos_hint: {"center_x": 0.17, "top": 0.78}
            background_color: 0.3, 0.3, 0.3, 1  # Dark metallic look
        
        # ---------- MIDDLE PANEL: PLAYBACK SPEED ----------
        Label:
            text: 'PLAYBACK SPEED'
            size_hint: None, None
            font_size: dp(18)
            color: 0, 1, 0, 1  # Green text
            width: dp(180)
            height: dp(30)
            pos_hint: {"center_x": 0.5, "top": 0.88}
        
        Spinner:
            id: speed_dropdown
            text: 'Select SPEED'
            size_hint: None, None
            width: dp(200)
            height: dp(40)
            values: ['10x', '20x', '60x', '90x']
            on_text: root.set_playback_speed(args[1])
            pos_hint: {"center_x": 0.5, "top": 0.78}
            background_color: 0.3, 0.3, 0.3, 1  # Dark metallic look
        
        # ---------- RIGHT PANEL: DISCO MODE ----------
        Label:
            text: 'DISCO MODE'
            size_hint: None, None
            font_size: dp(18)
            color: 0, 1, 0, 1  # Green text
            width: dp(150)
            height: dp(30)
            pos_hint: {"center_x": 0.83, "top": 0.88}
        
        Button:
            text: 'DISCO'
            size_hint: None, None
            width: dp(120)
            height: dp(50)
            background_color: 0.8, 0.2, 0.8, 1  # Purple/pink disco color
            on_press: root.start_disco_mode()
            pos_hint: {"center_x": 0.83, "top": 0.78}
        
        # ---------- INSTRUCTIONS ----------
        Label:
            text: 'Select data to playback - Insert USB for recorded'
            size_hint: None, None
            font_size: dp(14)
            color: 0, 1, 0, 1  # Green text
            width: dp(600)
            height: dp(24)
            pos_hint: {"center_x": 0.5, "center_y": 0.65}
        
        Label:
            text: 'Select speed to run playback (can adjust with +/-)'
            size_hint: None, None
            font_size: dp(14)
            color: 0, 1, 0, 1  # Green text
            width: dp(600)
            height: dp(24)
            pos_hint: {"center_x": 0.5, "center_y": 0.60}
        
        Label:
            text: 'Or select Disco Mode'
            size_hint: None, None
            font_size: dp(14)
            color: 0, 1, 0, 1  # Green text
            width: dp(600)
            height: dp(24)
            pos_hint: {"center_x": 0.5, "center_y": 0.55}
        
        # ---------- MAIN PLAYBACK CONTROLS ----------
        # Green Start Button (Bottom Left)
        Button:
            text: 'START'
            size_hint: None, None
            width: dp(120)
            height: dp(60)
            background_color: 0, 0.8, 0, 1  # Green
            disabled: (not root.current_file) or (root.arduino_connected == False)
            on_press: root.start_playback()
            pos_hint: {"center_x": 0.25, "center_y": 0.35}
        
        # Red Stop Button (Bottom Right)
        Button:
            text: 'STOP'
            size_hint: None, None
            width: dp(120)
            height: dp(60)
            background_color: 0.8, 0, 0, 1  # Red
            disabled: not root.is_playing
            on_press: root.stop_playback()
            pos_hint: {"center_x": 0.75, "center_y": 0.35}
        
        # Loop Button (Center Bottom)
        Button:
            text: 'LOOP'
            size_hint: None, None
            width: dp(100)
            height: dp(50)
            background_color: (0.2, 0.8, 0.2, 1) if root.loop_enabled else (0.6, 0.6, 0.6, 1)
            on_press: root.toggle_loop()
            pos_hint: {"center_x": 0.5, "center_y": 0.35}
        
        # ---------- STATUS DISPLAY (Bottom Rectangle) ----------
        Label:
            id: status_label
            text: 'Status: Ready to playback'
            size_hint: None, None
            width: dp(600)
            height: dp(40)
            background_color: 0, 0, 0, 0.8  # Semi-transparent black
            color: 0, 1, 0, 1  # Green text
            font_size: dp(16)
            text_size: self.size
            halign: 'center'
            valign: 'middle'
            pos_hint: {"center_x": 0.5, "bottom": 0.15}
        
        # ---------- BOTTOM TOOLBAR ----------
        Image:
            id: signal
            source: f"{root.mimic_directory}/Mimic/Pi/imgs/signal/signalred.zip"
            size_hint_y: 0.112
            anim_delay: 0.05
            anim_loop: 0
            fit_mode: "scale-down"
            pos_hint: {"center_x": 0.05, "center_y": 0.07}
        Image:
            id: arduino
            source: f"{root.mimic_directory}/Mimic/Pi/imgs/signal/arduino_offline.png"
            size_hint_y: 0.15
            anim_delay: 0.2
            anim_loop: 0
            fit_mode: "scale-down"
            pos_hint: {"center_x": 0.14, "center_y": 0.08}
        Label:
            id: arduino_count
            pos_hint: {"center_x": 0.14, "center_y": 0.08}
            text: ''
            markup: True
            color: 1,1,1
            font_size: self.height * 0.3
            size_hint_y: 0.5
        Button:
            size_hint: 0.1,0.11
            pos_hint: {"center_x": 0.9375, "center_y": 0.082}
            background_normal: f'{root.mimic_directory}/Mimic/Pi/imgs/eva/BackButton.png'
            on_release: app.root.current = 'main'