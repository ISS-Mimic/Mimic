#:import Factory kivy.factory.Factory
<DescriptionPopup@Popup>:
    title: 'Recorded ISS Data Descriptions'
    size_hint: 0.6, 0.4
    auto_dismiss: True

    BoxLayout:
        orientation: 'vertical'
        ScrollView:
            do_scroll_x: False  # Disabling horizontal scrolling
            do_scroll_y: True   # Enabling vertical scrolling

            # You can add your content inside this GridLayout
            GridLayout:
                cols: 1
                size_hint_y: None
                height: self.minimum_height  # Important for scrolling
                # Add your widgets here

                #Label:
                #    text: 'This will playback recorded data from when the Japanese HTV spacecraft berthed to the ISS. During berthing, the SARJs and nadir BGAs lock but the zenith BGAs autotrack'
                #    padding: 10, 10
                #    halign: 'center'
                #    text_size: self.width - 20, None

                # Example of a text box with ISS information
                Label:
                    text: 'This will playback recorded data from when the Japanese HTV spacecraft berthed to the ISS. During berthing, the SARJs and nadir BGAs lock but the zenith BGAs autotrack'
                    size_hint_y: None
                    height: self.texture_size[1] + 20  
                    text_size: self.width, None  
                    halign: 'left'
                    valign: 'middle'

                Label:
                    text: 'ISS Info 2: [More ISS info here]'
                    size_hint_y: None
                    height: self.texture_size[1] + 20
                    text_size: self.width, None
                    halign: 'left'
                    valign: 'middle'

                Label:
                    text: 'ISS Info 2: [More ISS info here]'
                    size_hint_y: None
                    height: self.texture_size[1] + 20
                    text_size: self.width, None
                    halign: 'left'
                    valign: 'middle'

                Label:
                    text: 'ISS Info 2: [More ISS info here]'
                    size_hint_y: None
                    height: self.texture_size[1] + 20
                    text_size: self.width, None
                    halign: 'left'
                    valign: 'middle'

                Label:
                    text: 'ISS Info 2: [More ISS info here]'
                    size_hint_y: None
                    height: self.texture_size[1] + 20
                    text_size: self.width, None
                    halign: 'left'
                    valign: 'middle'

                Label:
                    text: 'Demo orbit 2'
                    padding: 10, 10
                    halign: 'center'
                    text_size: self.width - 20, None

<ImageButton>:
    background_normal: f'{root.mimic_directory}/Mimic/Pi/imgs/playback/InfoIcon.png'
    fit_mode: "scale-down"

<Playback_Screen>:
    name: 'playback'
    
    FloatLayout:
        # Background or title
        Label:
            text: 'Playback Control'
            pos_hint: {"center_x": 0.5, "y": 0.95}
            font_size: dp(24)
            color: 1, 1, 1, 1
        
        # File Selection Dropdown
        Label:
            text: 'Data Source:'
            pos_hint: 0.1, 0.85
            font_size: dp(16)
            color: 1, 1, 1, 1
        
        Spinner:
            id: file_dropdown
            text: 'Select Data File'
            pos_hint: 0.1, 0.8
            size_hint: 0.3, 0.05
            values: ['HTV Demo', 'OFT2 Demo', 'Demo Demo']
            on_text: root.on_file_selected(args[1])
        
        # Speed Selection Dropdown
        Label:
            text: 'Playback Speed:'
            pos_hint: 0.5, 0.85 
            font_size: dp(16)
            color: 1, 1, 1, 1
        
        Spinner:
            id: speed_dropdown
            text: '10x'
            pos_hint: 0.5, 0.8
            size_hint: 0.2, 0.05
            values: ['10x', '20x', '60x', '90x']
            on_text: root.set_playback_speed(args[1])
        
        # Current File Display
        Label:
            text: 'No file selected'
            pos_hint: 0.5, 0.7
            font_size: dp(14)
            color: 0.8, 0.8, 0.8, 1
        
        # Playback Controls
        Button:
            text: 'Start'
            pos_hint: 0.2, 0.6
            size_hint: 0.15, 0.08
            disabled: not root.current_file or root.arduino_connected == False
            on_press: root.start_playback()
        
        Button:
            text: 'Stop'
            pos_hint: 0.4, 0.6
            size_hint: 0.15, 0.08
            disabled: not root.is_playing
            on_press: root.stop_playback()
        
        Button:
            text: 'Loop'
            pos_hint: 0.6, 0.6
            size_hint: 0.15, 0.08
            background_color: (0.2, 0.8, 0.2, 1) if root.loop_enabled else (0.6, 0.6, 0.6, 1)
            on_press: root.toggle_loop()
        
        # Status Information
        Label:
            text: 'Playback Status:'
            pos_hint: 0.1, 0.45
            font_size: dp(16)
            color: 1, 1, 1, 1
        
        Label:
            text: 'Stopped'
            pos_hint: 0.1, 0.4
            font_size: dp(14)
            color: 0.8, 0.8, 0.8, 1
        
        # Arduino Status
        Label:
            id: arduino_status
            text: 'Arduino: Disconnected'
            pos_hint: {"x": 0.1, "top": 0.3}
            font_size: dp(16)
            color: 1, 0, 0, 1
        
        Image:
            id: signal
            source: f"{root.mimic_directory}/Mimic/Pi/imgs/signal/signalred.zip"
            size_hint_y: 0.112
            anim_delay: 0.05
            anim_loop: 0
            fit_mode: "scale-down"
            pos_hint: {"center_x": 0.05, "center_y": 0.07}
        Image:
            id: arduino
            source: f"{root.mimic_directory}/Mimic/Pi/imgs/signal/arduino_offline.png"
            size_hint_y: 0.15
            anim_delay: 0.2
            anim_loop: 0
            fit_mode: "scale-down"
            pos_hint: {"center_x": 0.14, "center_y": 0.08}
        Label:
            id: arduino_count
            pos_hint: {"center_x": 0.14, "center_y": 0.08}
            text: ''
            markup: True
            color: 1,1,1
            font_size: self.height * 0.3
            size_hint_y: 0.5
        Button:
            size_hint: 0.1,0.11
            pos_hint: {"center_x": 0.9375, "center_y": 0.082}
            background_normal: f'{root.mimic_directory}/Mimic/Pi/imgs/eva/BackButton.png'
            on_release: app.root.current = 'orbit'
