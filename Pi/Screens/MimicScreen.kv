#:kivy 2.0.0

<MimicScreen>:
    name: 'mimic'
    FloatLayout:
        Image:
            id: Mimic_background
            source: f'{root.mimic_directory}/Mimic/Pi/imgs/mimic/MimicBaseWithStatusBar.png'
            fit_mode: "fill"

        Button:
            id: EPS_button
            size_hint: 0.15,0.13
            pos_hint: {"center_x": 0.15, "center_y": 0.62}
            background_normal: f'{root.mimic_directory}/Mimic/Pi/imgs/mimic/EPSunlit.png'
            background_down: f'{root.mimic_directory}/Mimic/Pi/imgs/mimic/EPSdown.png'
            on_release: root.manager.current = 'eps'

        Button:
            id: Crew_button
            size_hint: 0.15,0.13
            pos_hint: {"center_x": 0.5, "center_y": 0.34}
            background_normal: f'{root.mimic_directory}/Mimic/Pi/imgs/mimic/CrewUnlit.png'
            background_down: f'{root.mimic_directory}/Mimic/Pi/imgs/mimic/CrewDown.png'
            on_release: root.manager.current = 'crew'

        Button:
            id: CT_button
            size_hint: 0.15,0.13
            pos_hint: {"center_x": 0.33, "center_y": 0.62}
            background_normal: f'{root.mimic_directory}/Mimic/Pi/imgs/mimic/CTunlit.png'
            background_down: f'{root.mimic_directory}/Mimic/Pi/imgs/mimic/CTdown.png'
            on_release: root.manager.current = 'ct'

        Button:
            id: EVA_button
            size_hint: 0.15,0.13
            pos_hint: {"center_x": 0.33, "center_y": 0.48}
            background_normal: f'{root.mimic_directory}/Mimic/Pi/imgs/mimic/EVAunlit.png'
            background_down: f'{root.mimic_directory}/Mimic/Pi/imgs/mimic/EVAdown.png'
            on_release: root.manager.current = 'eva_main'

        Button:
            id: TCS_button
            size_hint: 0.15,0.13
            pos_hint: {"center_x": 0.68, "center_y": 0.62}
            background_normal: f'{root.mimic_directory}/Mimic/Pi/imgs/mimic/TCSunlit.png'
            background_down: f'{root.mimic_directory}/Mimic/Pi/imgs/mimic/TCSdown.png'
            on_release: root.manager.current = 'tcs'

        Button:
            id: ISS_button
            size_hint: 0.15,0.13
            pos_hint: {"center_x": 0.5, "center_y": 0.62}
            background_normal: f'{root.mimic_directory}/Mimic/Pi/imgs/mimic/ISSunlit.png'
            background_down: f'{root.mimic_directory}/Mimic/Pi/imgs/mimic/ISSdown.png'
            on_release: root.manager.current = 'iss'

        Button:
            id: ECLSS_button
            size_hint: 0.15,0.13
            pos_hint: {"center_x": 0.15, "center_y": 0.48}
            background_normal: f'{root.mimic_directory}/Mimic/Pi/imgs/mimic/ECLSSunlit.png'
            background_down: f'{root.mimic_directory}/Mimic/Pi/imgs/mimic/ECLSSdown.png'
            on_release: root.manager.current = 'eclss'

        Button:
            id: ROS_button
            size_hint: 0.15,0.13
            pos_hint: {"center_x": 0.855, "center_y": 0.34}
            background_normal: f'{root.mimic_directory}/Mimic/Pi/imgs/mimic/ROSunlit.png'
            background_down: f'{root.mimic_directory}/Mimic/Pi/imgs/mimic/ROSdown.png'
            on_release: root.manager.current = 'rs'

        Button:
            id: GNC_button
            size_hint: 0.15,0.13
            pos_hint: {"center_x": 0.855, "center_y": 0.62}
            background_normal: f'{root.mimic_directory}/Mimic/Pi/imgs/mimic/GNCunlit.png'
            background_down: f'{root.mimic_directory}/Mimic/Pi/imgs/mimic/GNCdown.png'
            on_release: root.manager.current = 'gnc'

        Button:
            id: Orbit_button
            size_hint: 0.15,0.13
            pos_hint: {"center_x": 0.5, "center_y": 0.48}
            background_normal: f'{root.mimic_directory}/Mimic/Pi/imgs/mimic/OrbitUnlit.png'
            background_down: f'{root.mimic_directory}/Mimic/Pi/imgs/mimic/OrbitDown.png'
            on_release: root.manager.current = 'orbit'

        Button:
            id: Robo_button
            size_hint: 0.15,0.13
            pos_hint: {"center_x": 0.68, "center_y": 0.48}
            background_normal: f'{root.mimic_directory}/Mimic/Pi/imgs/mimic/RoboUnlit.png'
            background_down: f'{root.mimic_directory}/Mimic/Pi/imgs/mimic/RoboDown.png'
            on_release: root.manager.current = 'robo'

        Button:
            id: CDH_button
            size_hint: 0.15,0.13
            pos_hint: {"center_x": 0.855, "center_y": 0.48}
            background_normal: f'{root.mimic_directory}/Mimic/Pi/imgs/mimic/CDHunlit.png'
            background_down: f'{root.mimic_directory}/Mimic/Pi/imgs/mimic/CDHdown.png'
            on_release: root.manager.current = 'cdh'

        Button:
            id: VV_button
            size_hint: 0.15,0.13
            pos_hint: {"center_x": 0.33, "center_y": 0.34}
            background_normal: f'{root.mimic_directory}/Mimic/Pi/imgs/mimic/VVunlit.png'
            background_down: f'{root.mimic_directory}/Mimic/Pi/imgs/mimic/VVdown.png'
            on_release: root.manager.current = 'vv'

        Button:
            id: USOS_button
            size_hint: 0.15,0.13
            pos_hint: {"center_x": 0.15, "center_y": 0.34}
            background_normal: f'{root.mimic_directory}/Mimic/Pi/imgs/mimic/USOSunlit.png'
            background_down: f'{root.mimic_directory}/Mimic/Pi/imgs/mimic/USOSdown.png'
            on_release: root.manager.current = 'usos'

        Button:
            id: Science_button
            size_hint: 0.15,0.13
            pos_hint: {"center_x": 0.68, "center_y": 0.34}
            background_normal: f'{root.mimic_directory}/Mimic/Pi/imgs/mimic/ScienceUnlit.png'
            background_down: f'{root.mimic_directory}/Mimic/Pi/imgs/mimic/ScienceDown.png'
            on_release: root.manager.current = 'science'


        Button:
            id: mimicstartbutton
            size_hint: 0.15,0.12
            pos_hint: {"center_x": 0.25, "center_y": 0.2}
            text: 'Transmit \n to Model'
            halign: "center" 
            disabled: False
            font_size: self.height * 0.4
            size_hint_y: 0.1
            on_release: mimicstartbutton.text = 'Sending...'
            on_release: root.mimic_transmit(True)
            on_release: mimicstopbutton.disabled = False
            on_release: mimicstartbutton.disabled = True

        Button:
            id: mimicstopbutton
            size_hint: 0.15,0.12
            pos_hint: {"center_x": 0.40, "center_y": 0.2}
            text: 'Stop'
            disabled: True
            font_size: self.height * 0.4
            size_hint_y: 0.1
            on_release: mimicstartbutton.text = 'Transmit'
            on_release: root.mimic_transmit(False)
            on_release: mimicstopbutton.disabled = True
            on_release: mimicstartbutton.disabled = False

        Button:
            id: startTelemetry
            size_hint: 0.15,0.12
            pos_hint: {"center_x": 0.60, "center_y": 0.2}
            text: 'Connect \n to ISS'
            font_size: self.height * 0.4
            size_hint_y: 0.1
            width: 50
            height: 20
            halign: "center" 
            on_release: stopTelemetry.disabled = False
            on_release: self.disabled = True
            on_release: root.startproc()

        Button:
            id: stopTelemetry
            size_hint: 0.15,0.12
            pos_hint: {"center_x": 0.75, "center_y": 0.2}
            text: 'Stop \n Connection'
            font_size: self.height * 0.4
            size_hint_y: 0.1
            width: 50
            height: 20
            halign: "center" 
            disabled: True
            on_release: startTelemetry.disabled = False
            on_release: self.disabled = True
            on_release: root.killproc()


        # ---------- STATUS DISPLAY (Bottom Rectangle) ----------
        Label:
            id: status_label
            text: 'Ready to Mimic'
            size_hint: 1, 0.07
            background_color: 0, 0, 0, 0.8  # Semi-transparent black
            color: 0, 1, 0, 1  # Green text
            font_size: self.height * 0.6  # Scale font to label height
            text_size: self.size
            halign: 'center'
            valign: 'middle'
            pos_hint: {"center_x": 0.57, "center_y": 0.07}
        
        # ---------- BOTTOM TOOLBAR ----------
        Image:
            id: signal
            source: f"{root.mimic_directory}/Mimic/Pi/imgs/signal/signalred.zip"
            size_hint_y: 0.112
            anim_delay: 0.05
            anim_loop: 0
            fit_mode: "scale-down"
            pos_hint: {"center_x": 0.05, "center_y": 0.07}
        
        Image:
            id: arduino
            source: f"{root.mimic_directory}/Mimic/Pi/imgs/signal/arduino_offline.png"
            size_hint_y: 0.15
            anim_delay: 0.2
            anim_loop: -1
            fit_mode: "scale-down"
            pos_hint: {"center_x": 0.14, "center_y": 0.08}
        
        Label:
            id: arduino_count
            pos_hint: {"center_x": 0.14, "center_y": 0.08}
            text: ''
            markup: True
            color: 1, 1, 1, 1
            font_size: self.height * 1
            size_hint: 0.06, 0.08
        
        # ─────────────────────── Navigation ────────────────────────────────

        Button:
            size_hint: 0.1, 0.11
            pos_hint: {"center_x": 0.9375, "center_y": 0.07}
            background_normal: f'{root.mimic_directory}/Mimic/Pi/imgs/eva/BackButton.png'
            background_down: f'{root.mimic_directory}/Mimic/Pi/imgs/eva/BackButton.png'
            border: 0,0,0,0    # avoid 9-slice margins
            on_release: root.mimic_transmit(False)
            on_release: mimicstartbutton.text = 'Transmit'
            on_release: mimicstopbutton.disabled = True
            on_release: mimicstartbutton.disabled = False
            on_release: startTelemetry.disabled = False
            on_release: stopTelemetry.disabled = True
            on_release: root.killproc()
            on_release: app.root.current = 'main'